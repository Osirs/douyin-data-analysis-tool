# 抖音测试白名单授权配置说明

## 问题解决方案

当您在扫码授权时遇到"非法重定向链接"错误，这是因为 `redirect_uri` 参数与您在抖音开放平台应用配置中设置的授权回调域不匹配导致的。

## 获取必要参数的步骤

### 1. 获取 Client Key 和 Client Secret

1. 访问 [抖音开放平台](https://open.douyin.com/)
2. 登录您的开发者账号
3. 进入「控制台」→「我的应用」→「网站应用」
4. 在应用详情页面的「应用信息」中找到：
   - **Client Key**（应用唯一标识）
   - **Client Secret**（应用密钥）

### 2. 配置授权回调域

1. 在同一个应用页面，找到「授权回调」设置
2. 添加或修改授权回调URL，常用选项：
   - **测试环境**: `http://localhost:3000/auth/callback`
   - **生产环境**: `https://yourdomain.com/auth/callback`
   - **抖音官方**: `https://www.douyin.com`
   - **API回调**: `https://api.snssdk.com/oauth/authorize/callback/`

### 3. 重要注意事项

- **回调地址必须完全匹配**：授权链接中的 `redirect_uri` 必须与平台配置中的回调域完全一致
- **协议要求**：生产环境必须使用 HTTPS，测试环境可以使用 HTTP
- **路径匹配**：只校验 `#` 号前的内容，但建议完整匹配

## 使用授权页面的步骤

### 步骤1：配置参数
1. 打开授权页面：`http://localhost:3000/whitelist-auth`
2. 在「配置参数」部分输入您的真实 **Client Key**
3. 选择或输入正确的 **回调地址**（必须与平台配置一致）
4. 点击「更新配置并生成二维码」

### 步骤2：扫码授权
1. 使用抖音APP扫描生成的二维码
2. 在授权页面选择「同意授权」
3. 确认授权 `trial.whitelist` 权限

### 步骤3：验证结果
- 授权成功后，您的抖音账号将被加入测试白名单
- 可以开始使用相关的测试功能

## 常见回调地址配置

| 环境类型 | 推荐回调地址 | 说明 |
|---------|-------------|------|
| 本地测试 | `http://localhost:3000/auth/callback` | 本地开发环境 |
| 抖音官方 | `https://www.douyin.com` | 使用抖音官方域名 |
| API回调 | `https://api.snssdk.com/oauth/authorize/callback/` | 抖音API回调地址 |
| 自定义域名 | `https://yourdomain.com/callback` | 您自己的域名 |

## 故障排除

### 问题1："非法重定向链接"
**解决方案**：
- 检查回调地址是否与平台配置完全一致
- 确认协议（http/https）是否正确
- 验证域名和路径是否匹配

### 问题2："应用未通过审核"
**解决方案**：
- 确认应用已通过抖音开放平台审核
- 检查应用状态是否为"已上线"

### 问题3："权限不足"
**解决方案**：
- 确认应用已申请 `trial.whitelist` 权限
- 联系抖音开放平台客服申请测试权限

## 技术支持

如果您在配置过程中遇到问题：

1. **检查应用配置**：确保在抖音开放平台正确配置了回调域
2. **验证参数格式**：确保 Client Key 和回调地址格式正确
3. **联系平台客服**：如需申请特殊权限或解决账号问题

## 安全提醒

- **保护密钥安全**：不要在公开代码中暴露 Client Secret
- **使用HTTPS**：生产环境务必使用HTTPS协议
- **定期更新**：定期检查和更新应用配置

---

**注意**：此配置仅用于测试白名单申请，正式环境请使用经过抖音开放平台完整审核的应用。